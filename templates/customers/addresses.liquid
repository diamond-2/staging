{% paginate customer.addresses by 5 %}

<div class="account_section_wrapper address_section_wrapper padding_t">
  <div class="container_fluid">
    <div class="sp-account-section-holder">
      <!-- Top Section 'Breadcrumbs', 'Welocome User', 'Top Nav' -->
      {% include 'account-top-section' %}

      <div class="sp-account-section">
        <div class="container_fluid_inner">
          <header class="addess_section_header">
            <h2 class="hide_mobile">{{ 'customer.addresses.title' | t }}</h2>
            <div class="account_sec_header_mobile show_mobile">
              <div class="back-to-page-btn">{% include 'icon-back-arrow' %}</div>
              <p>Welcome, {{ customer.first_name }}</p>
              <h4>{{ 'customer.addresses.title' | t }}</h4>
            </div>
            <p><button type="button" class="btn address-new-toggle" id="AddressNewButton" aria-expanded="false" aria-owns="AddressNewForm">{{ 'customer.addresses.add_new' | t }}</button></p>
          </header>

          <div class="grid">
            <div class="grid__item medium-up--two-thirds medium-up--push-one-sixth">
              {% comment %}
                Add address form, hidden by default
              {% endcomment %}
              <div id="AddressNewForm" class="form-vertical account_glb_form hide">
                {% form 'customer_address', customer.new_address %}
                  <h3>{{ 'customer.addresses.add_new' | t }}</h3>

                  <div class="grid">
                    <div class="grid__item medium-up--one-half">
                      <label for="AddressFirstNameNew">{{ 'customer.addresses.first_name' | t }}</label>
                      <input type="text" id="AddressFirstNameNew" name="address[first_name]" value="{{ form.first_name }}" autocomplete="given-name">
                      <div class="msg-error"></div>
                    </div>

                    <div class="grid__item medium-up--one-half">
                      <label for="AddressLastNameNew">{{ 'customer.addresses.last_name' | t }}</label>
                      <input type="text" id="AddressLastNameNew" name="address[last_name]" value="{{ form.last_name }}" autocomplete="family-name">
                      <div class="msg-error"></div>
                    </div>
                  </div>

                  <div class="grid">
                    <div class="grid__item medium-up--one-half">
                      <label for="AddressCompanyNew">{{ 'customer.addresses.company' | t }}</label>
                      <input type="text" id="AddressCompanyNew" name="address[company]" value="{{ form.company }}" autocomplete="organization">
                      <div class="msg-error"></div>
                    </div>
                    <div class="grid__item medium-up--one-half">
                      <label for="AddressAddress1New">{{ 'customer.addresses.address1' | t }}</label>
                      <input type="text" id="AddressAddress1New" name="address[address1]" value="{{ form.address1 }}" autocomplete="street-address address-line1">
                      <div class="msg-error"></div>
                    </div>
                  </div>

                  <div class="grid">
                    <div class="grid__item medium-up--one-half">
                      <label for="AddressAddress2New">{{ 'customer.addresses.address2' | t }}</label>
                      <input type="text" id="AddressAddress2New" name="address[address2]" value="{{ form.address2 }}" autocomplete="street-address address-line2">
                      <div class="msg-error"></div>
                    </div>
                    <div class="grid__item medium-up--one-half">
                      <label for="AddressCityNew">{{ 'customer.addresses.city' | t }}</label>
                      <input type="text" id="AddressCityNew" name="address[city]" value="{{ form.city }}" autocomplete="address-level2">
                      <div class="msg-error"></div>
                    </div>
                  </div>

                  <div class="grid">
                    <div class="grid__item medium-up--one-half">
                      <label for="AddressCountryNew">{{ 'customer.addresses.country' | t }}</label>
                      <select id="AddressCountryNew" name="address[country]" data-default="{{ form.country }}" autocomplete="country">{{ all_country_option_tags }}</select>
                    </div>
                    <div class="grid__item medium-up--one-half">
                      <div id="AddressProvinceContainerNew" style="display:none">
                        <label for="AddressProvinceNew">{{ 'customer.addresses.province' | t }}</label>
                        <select id="AddressProvinceNew" name="address[province]" data-default="{{ form.province }}" autocomplete="address-level1"></select>
                      </div>
                    </div>
                  </div>

                  <div class="grid">
                    <div class="grid__item medium-up--one-half">
                      <label for="AddressZipNew">{{ 'customer.addresses.zip' | t }}</label>
                      <input type="text" id="AddressZipNew" name="address[zip]" value="{{ form.zip }}" autocapitalize="characters" autocomplete="postal-code">
                      <div class="msg-error"></div>
                    </div>
                    <div class="grid__item medium-up--one-half">
                      <label for="AddressPhoneNew">{{ 'customer.addresses.phone' | t }}</label>
                      <input type="tel" id="AddressPhoneNew" name="address[phone]" value="{{ form.phone }}" autocomplete="phone">
                      <div class="msg-error"></div>
                    </div>
                  </div>
                  
                  <div class="agree-terms-sec">
                    <div class="custom-checkbox-holder">
                      <div class="custom-checkbox-input-box">
                        {{ form.set_as_default_checkbox }}
                        <span><i><svg width="23" height="17" viewBox="0 0 23 17" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.63448 14.8756L8 15.2672L8.36553 14.8756L21.6345 0.658845C21.8229 0.456969 22.1393 0.446059 22.3412 0.634476L22.6823 0.268948L22.3412 0.634476C22.543 0.822893 22.5539 1.13929 22.3655 1.34116L8.36553 16.3412C8.27097 16.4425 8.1386 16.5 8 16.5C7.86141 16.5 7.72904 16.4425 7.63448 16.3412L7.26895 16.6823L7.63448 16.3412L0.634476 8.84116C0.446059 8.63929 0.456969 8.32289 0.658845 8.13448C0.86072 7.94606 1.17711 7.95697 1.36553 8.15885L7.63448 14.8756Z" stroke="#6679CC"></path></svg></i></span>
                      </div>
                      <label for="address_default_address_new">{{ 'customer.addresses.set_default' | t }}</label>
                    </div>
                  </div>
                  <div class="form_acctions">
                    <div><input type="submit" class="btn" value="{{ 'customer.addresses.add' | t }}"></div>
                    <div><button type="button" class="btn secondary-btn text-link address-new-toggle">{{ 'customer.addresses.cancel' | t }}</button></div>
                  </div>
                {% endform %}
              </div>

              {% comment %}
                List all customer addresses with a unique edit form.
                Also add pagination in case they have a large number of addresses
              {% endcomment %}
              <ul class="address_item_grid">
                {% for address in customer.addresses %}  
                <li class="address_item " >
                    <div class="address">
                      <div class="address_title_flex">
                        {% if address.first_name %}
                        <h5>{{ address.first_name }} {{ address.last_name }}</h5>
                        {% endif %}
                        {% if address == customer.default_address %}
                          <h6>{{ 'customer.addresses.default' | t }}</h6>
                        {% endif %}
                      </div>
                      {{ address | format_address }}

                      <ul class="list--inline">
                        <li>
                          <button
                            id="EditFormButton_{{ address.id }}"
                            type="button"
                            class="btn secondary-btn btn--small address-edit-toggle"
                            data-form-id="{{ address.id }}"
                            aria-owns="EditAddress_{{ address.id }}"
                            aria-expanded="false"
                          >
                            {{ 'customer.addresses.edit' | t }}
                          </button>
                        </li>
                        <li>
                          <button
                            type="button"
                            class="btn btn--small address-delete"
                            data-target="{{ address.url }}"
                            data-confirm-message="{{ 'customer.addresses.delete_confirm' | t }}"
                          >{% include 'icon-trash' %}</button>
                        </li>
                      </ul>
                    </div>

                    <div id="EditAddress_{{ address.id }}" class="account_glb_form form-vertical hide edit_address_form">
                      {% form 'customer_address', address %}

                        <h3>{{ 'customer.addresses.edit_address' | t }}</h3>

                        <div class="grid">
                          <div class="grid__item medium-up--one-half">
                            <label for="AddressFirstName_{{ form.id }}">{{ 'customer.addresses.first_name' | t }}</label>
                            <input type="text" id="AddressFirstName_{{ form.id }}" name="address[first_name]" value="{{ form.first_name }}" autocomplete="given-name">
                            <div class="msg-error"></div>
                          </div>
                          <div class="grid__item medium-up--one-half">
                            <label for="AddressLastName_{{ form.id }}">{{ 'customer.addresses.last_name' | t }}</label>
                            <input type="text" id="AddressLastName_{{ form.id }}" name="address[last_name]" value="{{ form.last_name }}" autocomplete="family-name">
                            <div class="msg-error"></div>
                          </div>
                        </div>
                        <div class="grid">
                          <div class="grid__item medium-up--one-half">
                            <label for="AddressCompany_{{ form.id }}">{{ 'customer.addresses.company' | t }}</label>
                            <input type="text" id="AddressCompany_{{ form.id }}" name="address[company]" value="{{ form.company }}" autocomplete="organization">
                            <div class="msg-error"></div>
                          </div>
                          <div class="grid__item medium-up--one-half">
                            <label for="AddressAddress1_{{ form.id }}">{{ 'customer.addresses.address1' | t }}</label>
                            <input type="text" id="AddressAddress1_{{ form.id }}" name="address[address1]" value="{{ form.address1 }}" autocomplete="street-address address-line1">
                            <div class="msg-error"></div>
                          </div>
                        </div>

                        <div class="grid">
                          <div class="grid__item medium-up--one-half">
                            <label for="AddressAddress2_{{ form.id }}">{{ 'customer.addresses.address2' | t }}</label>
                            <input type="text" id="AddressAddress2_{{ form.id }}" name="address[address2]" value="{{ form.address2 }}" autocomplete="street-address address-line2">
                            <div class="msg-error"></div>
                          </div>
                          <div class="grid__item medium-up--one-half">
                            <label for="AddressCity_{{ form.id }}">{{ 'customer.addresses.city' | t }}</label>
                            <input type="text" id="AddressCity_{{ form.id }}" name="address[city]" value="{{ form.city }}" autocomplete="address-level2">
                            <div class="msg-error"></div>
                          </div>
                        </div>

                        <div class="grid">
                          <div class="grid__item medium-up--one-half">
                            <label for="AddressCountry_{{ form.id }}">{{ 'customer.addresses.country' | t }}</label>
                            <select id="AddressCountry_{{ form.id }}" class="address-country-option" data-form-id="{{ form.id }}" name="address[country]" data-default="{{ form.country }}" autocomplete="country">{{ all_country_option_tags }}</select>
                          </div>
                          <div class="grid__item medium-up--one-half">
                            <div id="AddressProvinceContainer_{{ form.id }}" style="display:none">
                              <label for="AddressProvince_{{ form.id }}">{{ 'customer.addresses.province' | t }}</label>
                              <select id="AddressProvince_{{ form.id }}" name="address[province]" data-default="{{ form.province }}" autocomplete="address-level1"></select>
                            </div>    
                          </div>
                        </div>
                        
                        <div class="grid">
                          <div class="grid__item medium-up--one-half">
                            <label for="AddressZip_{{ form.id }}">{{ 'customer.addresses.zip' | t }}</label>
                            <input type="text" id="AddressZip_{{ form.id }}" name="address[zip]" value="{{ form.zip }}" autocapitalize="characters" autocomplete="postal-code">
                            <div class="msg-error"></div>
                          </div>

                          <div class="grid__item medium-up--one-half">
                            <label for="AddressPhone_{{ form.id }}">{{ 'customer.addresses.phone' | t }}</label>
                            <input type="tel" id="AddressPhone_{{ form.id }}" name="address[phone]" value="{{ form.phone }}" autocomplete="phone">
                            <div class="msg-error"></div>
                          </div>
                        </div>

                        <div class="agree-terms-sec">
                          <div class="custom-checkbox-holder">
                            <div class="custom-checkbox-input-box">
                              {{ form.set_as_default_checkbox }}
                              <span><i><svg width="23" height="17" viewBox="0 0 23 17" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.63448 14.8756L8 15.2672L8.36553 14.8756L21.6345 0.658845C21.8229 0.456969 22.1393 0.446059 22.3412 0.634476L22.6823 0.268948L22.3412 0.634476C22.543 0.822893 22.5539 1.13929 22.3655 1.34116L8.36553 16.3412C8.27097 16.4425 8.1386 16.5 8 16.5C7.86141 16.5 7.72904 16.4425 7.63448 16.3412L7.26895 16.6823L7.63448 16.3412L0.634476 8.84116C0.446059 8.63929 0.456969 8.32289 0.658845 8.13448C0.86072 7.94606 1.17711 7.95697 1.36553 8.15885L7.63448 14.8756Z" stroke="#6679CC"></path></svg></i></span>
                            </div>
                            <label for="address_default_address_{{ form.id }}">{{ 'customer.addresses.set_default' | t }}</label>
                          </div>
                        </div>

                        <div class="form_acctions">
                          <div><input type="submit" class="btn" value="{{ 'customer.addresses.update' | t }}"></div>
                          <div><button type="button" class="btn secondary-btn text-link address-edit-toggle" data-form-id="{{ form.id }}">{{ 'customer.addresses.cancel' | t }}</button></div>
                        </div>

                      {% endform %}
                      
                    </div>
                  </li>
                {% endfor %}
              </ul>

              {%- if paginate.pages > 1 -%}
                {% include 'pagination', paginate: paginate %}
              {%- endif -%}
            </div>
          </div>
        </div>
      </div>
    </div>
    
  </div>
</div>
{% endpaginate %}



<script>
  document.addEventListener('DOMContentLoaded', function(event) {
    function validateForm($this) {
      var firstName = $this.find('input[name="address[first_name]"]').val().trim();
      var lastName = $this.find('input[name="address[last_name]').val().trim();
      var thisPhone = $this.find('input[name="address[phone]"]').val().trim();
      var addressVlidation = $this.find('input[name="address[address1]"]').val().trim();
      var cityVlidation = $this.find('input[name="address[city]"]').val().trim();
      var zipValidation = $this.find('input[name="address[zip]"]').val().trim();
      var nameRegx = /^[a-zA-Z]+(([',. -][a-zA-Z ])?[a-zA-Z0-9]*)*$/;
      var regmm='^([0|+[0-9]{1,5})?([7-9][0-9]{9})$';
      var regmob = new RegExp(regmm);
      if (firstName == "" || firstName == null) {
        $this.find('input[name="address[first_name]"]').addClass('form-error').next('.msg-error').text("Enter Your First Name").css('display','block');
      } else if (nameRegx.test(firstName) == false ){
        $this.find('input[name="address[first_name]"]').addClass('form-error').next('.msg-error').text("Please Enter Valid First Name").css('display','block');
      } else {
        $this.find('input[name="address[first_name]"]').removeClass('form-error').next('.msg-error').empty().css('display','none');
      }
      if (lastName == "" || lastName == null) {
        $this.find('input[name="address[last_name]').addClass('form-error').next('.msg-error').text("Enter Your Last Name").css('display','block');
      } else if (nameRegx.test(lastName) == false ){
        $this.find('input[name="address[last_name]').addClass('form-error').next('.msg-error').text("Please Enter Valid Last Name").css('display','block');
      } else {
        $this.find('input[name="address[last_name]').removeClass('form-error').next('.msg-error').empty().css('display','none');
      }
      if (thisPhone.length != 10 || thisPhone == null || regmob.test(thisPhone) == false) {
        $this.find('input[name="address[phone]"]').addClass('form-error').next('.msg-error').text("Enter Your Valid Phone Number").css('display','block');
      } else {
        $this.find('input[name="address[phone]"]').removeClass('form-error').next('.msg-error').empty().css('display','none');
      }
      if (addressVlidation == "" || addressVlidation == null) {
        $this.find('input[name="address[address1]').addClass('form-error').next('.msg-error').text("Field cannot be blank").css('display','block');
      } else {
        $this.find('input[name="address[address1]').removeClass('form-error').next('.msg-error').empty().css('display','none');
      }
      if (cityVlidation == "" || cityVlidation == null) {
        $this.find('input[name="address[city]').addClass('form-error').next('.msg-error').text("Field cannot be blank").css('display','block');
      } else {
        $this.find('input[name="address[city]').removeClass('form-error').next('.msg-error').empty().css('display','none');
      }
      if (zipValidation == "" || zipValidation == null) {
        $this.find('input[name="address[zip]').addClass('form-error').next('.msg-error').text("Field cannot be blank").css('display','block');
      } else {
        $this.find('input[name="address[zip]').removeClass('form-error').next('.msg-error').empty().css('display','none');
      }
      
    }
    

    $('input[type="submit"]').click(function(e){
      removeMessage();
      e.preventDefault();
      var $this = $(this).closest('form');
      validateForm($this);
      if($this.find('input.form-error').length > 0) {
        return false;
      } else {
        $this.submit();
      }
      
    });
    $('form').on('keyup', 'input', function() {
      $(this).removeClass('form-error').next('.msg-error').empty().css('display','none');
    });
    function removeMessage(){    
      setTimeout(function(){
        $('.msg-error').empty().css('display','none');
        $('form input').removeClass('form-error');
      },5000)
    }

  });
</script>

